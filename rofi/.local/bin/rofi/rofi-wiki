#!/bin/bash
# Dependencies: tesseract-ocr imagemagick scrot xsel wikit rofi
# Credit: https://gist.github.com/Amooti73/94dc1efe2fd120d6735cf0a3b21e2994#file-wikx-sh
set -e

SCR_IMG=$(mktemp)
trap 'rm $SCR_IMG*' EXIT

scrot -s "$SCR_IMG.png"
mogrify -modulate 100,0 -resize 400% "$SCR_IMG.png" #should increase detection rate
tesseract "$SCR_IMG.png" "$SCR_IMG" &> /dev/null
cat  "$SCR_IMG.txt" > wordy.txt
tr -d '\014' <wordy.txt > words.txt
src=$(cat words.txt)

test "$src" = "$(cat words.txt)"

rofi="rofi -dmenu -yoffset 30 -location 2"

pag() {                                                 \
     eval "$rofi" -l 20 -p 'Done'
}

phrase=$(echo "$src"|eval "$rofi -markup -p 'Lookup '")

{
    wikit "$phrase" --line 80 --link
} | pag
